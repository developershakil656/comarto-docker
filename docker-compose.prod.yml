services:
  nginx:
    volumes:
      - ./nginx/templates/prod:/etc/nginx/templates/:ro
      - /etc/letsencrypt:/etc/letsencrypt:ro
      - /var/lib/letsencrypt:/var/lib/letsencrypt:ro
      - /var/www/certbot:/var/www/certbot:ro
      - ./admin-backend/app:/var/www/admin-backend:ro
      - ./backend/app:/var/www/backend:ro
      # Allow Nginx to serve the built frontend files
      - frontend_build:/var/www/frontend:ro 
      - admin_frontend_build:/var/www/admin-frontend:ro

  frontend:
    image: alpine:latest
    restart: "no" # Built files stay on host, container doesn't need to stay up
    command: sh -c "echo 'Frontend built assets mounted directly to nginx.' && tail -f /dev/null"
    volumes:
      - frontend_build:/shared_frontend

  admin-frontend:
    image: alpine:latest
    restart: "no"
    command: sh -c "echo 'Admin frontend built assets mounted directly to nginx.' && tail -f /dev/null"
    volumes:
      - admin_frontend_build:/shared_admin_frontend

  backend:
    restart: always
    volumes:
      - ./backend/app/storage:/var/www/backend/storage

  admin-backend:
    restart: always
    volumes:
      - ./admin-backend/app/storage:/var/www/admin-backend/storage

  # mysql:
  #   restart: always